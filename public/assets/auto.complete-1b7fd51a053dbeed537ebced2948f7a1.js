/*
 * jquery.autocomplete.js
 * Dylan Verheul, Anjesh Tuladhar
 * Licensed under the MIT license
 */
$.autocomplete=function(a,b){function m(){var a=d.val();if(a==i)return;i=a,a.length>=b.minChars?(d.addClass(b.loadingClass),v(a)):(d.removeClass(b.loadingClass),f.hide())}function n(a){var b=$("li",e);if(!b)return;j+=a,j<0?j=0:j>=b.size()&&(j=b.size()-1),b.removeClass("over"),$(b[j]).addClass("over")}function o(){var a=$("li.over",e)[0];if(!a){var c=$("li",e);b.selectOnly?c.length==1&&(a=c[0]):b.selectFirst&&(a=c[0])}return a?(p(a),!0):!1}function p(c){c||(c=document.createElement("li"),c.extra=[],c.selectValue="");var e=$.trim(c.selectValue?c.selectValue:c.innerHTML);a.lastSelected=e,i=e,f.html(""),new_value=e,b.mode=="multiple"&&(old_value=d.val(),old_value.lastIndexOf(b.separator)>=1?(comma_pos=old_value.lastIndexOf(b.separator),value=old_value.substr(0,comma_pos+1),new_value=value+" "+e+b.separator):new_value=e+b.separator),d.val(new_value),r(),b.onItemSelect&&setTimeout(function(){b.onItemSelect(c)},1)}function q(){h&&clearTimeout(h),h=setTimeout(r,200)}function r(){h&&clearTimeout(h),d.removeClass(b.loadingClass),f.is(":visible")&&f.hide();if(b.mustMatch){var c=d.val();c!=a.lastSelected&&p(null)}}function s(a,c){c?(d.removeClass(b.loadingClass),e.innerHTML="",$.browser.msie&&f.append(document.createElement("iframe")),e.appendChild(u(c)),f.show()):r()}function t(a){if(!a)return null;var c=[],d=a.split(b.lineSeparator);for(var e=0;e<d.length;e++){var f=$.trim(d[e]);f&&(c[c.length]=f.split(b.cellSeparator))}return c}function u(a){var c=document.createElement("ul"),d=a.length;for(var e=0;e<d;e++){var f=a[e];if(!f)continue;var g=document.createElement("li");b.formatItem?(g.innerHTML=b.formatItem(f,e,d),g.selectValue=f[0]):g.innerHTML=f[0];var h=null;if(f.length>1){h=[];for(var i=1;i<f.length;i++)h[h.length]=f[i]}g.extra=h,c.appendChild(g),$(g).hover(function(){$("li",c).removeClass("over"),$(this).addClass("over")},function(){$(this).removeClass("over")}).click(function(a){a.preventDefault(),a.stopPropagation(),p(this)})}return c}function v(a){b.matchCase||(a=a.toLowerCase());var c=b.cacheLength?x(a):null;c?s(a,c):$.get(w(a),function(b){b=t(b),z(a,b),s(a,b)})}function w(a){b.mode=="multiple"&&a.lastIndexOf(b.separator)>=1&&(comma_pos=a.lastIndexOf(b.separator),a=a.substr(comma_pos+1));var c=b.url+"?q="+a;for(var d in b.extraParams)c+="&"+d+"="+b.extraParams[d];return c}function x(a){return null}function y(a,c){b.matchCase||(a=a.toLowerCase());var d=a.indexOf(c);return d==-1?!1:d==0||b.matchContains}function z(a,c){if(!c||!a||!b.cacheLength)return;!k.length||k.length>b.cacheLength?(k={},k.length=1):k[a]||k.length++,k[a]=c}function A(a){var b=a.offsetLeft||0,c=a.offsetTop||0;while(a=a.offsetParent)b+=a.offsetLeft,c+=a.offsetTop;return{x:b,y:c}}var c=this,d=$(a).attr("autocomplete","off");b.inputClass&&d.addClass(b.inputClass);var e=document.createElement("div"),f=$(e),g=A(a);f.hide().addClass(b.resultsClass).css({position:"absolute",top:g.y+a.offsetHeight+"px",left:g.x+"px"}),$("body").append(e),a.autocompleter=c,a.lastSelected=d.val();var h=null,i="",j=-1,k={},l=!1;d.keydown(function(a){if(f)switch(a.keyCode){case 38:a.preventDefault(),n(-1);break;case 40:a.preventDefault(),n(1);break;case 9:case 13:o()&&a.preventDefault();break;default:j=-1,h&&clearTimeout(h),h=setTimeout(m,b.delay)}}).blur(function(){q()}),r(),this.flushCache=function(){k={}},this.setExtraParams=function(a){b.extraParams=a}},$.fn.autocomplete=function(a,b){return b=b||{},b.url=a,b.inputClass=b.inputClass||"",b.resultsClass=b.resultsClass||"ac_results",b.lineSeparator=b.lineSeparator||"\n",b.cellSeparator=b.cellSeparator||"|",b.minChars=b.minChars||1,b.delay=b.delay||400,b.matchCase=b.matchCase||0,b.matchSubset=b.matchSubset||1,b.matchContains=b.matchContains||0,b.cacheLength=b.cacheLength||1,b.mustMatch=b.mustMatch||0,b.extraParams=b.extraParams||{},b.loadingClass=b.loadingClass||"ac_loading",b.selectFirst=b.selectFirst||!1,b.selectOnly=b.selectOnly||!1,b.mode=b.mode||"single",b.separator=b.separator||",",this.each(function(){var a=this;new $.autocomplete(a,b)}),this};